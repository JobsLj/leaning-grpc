<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>概述(笔记) | Leaning Grpc</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="../grpc/grpc_concepts.html" />
    
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="3.1.1" data-basepath=".." data-revision="1448270417335">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="introduction/index.html">
            
                
                    <a href="../introduction/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         google grpc 介绍
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="introduction/information.html">
            
                
                    <a href="../introduction/information.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         google grpc 信息
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Protocol Buffer</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" >
            
            <span><b>2.1.</b> 官网开发指南</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1.1" data-path="proto3/overview.html">
            
                
                    <a href="../proto3/overview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                         概述(笔记)
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.2" data-path="proto3/language_guide.html">
            
                
                    <a href="../proto3/language_guide.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.2.</b>
                        
                         语言指南(翻译)
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.3" data-path="proto3/style_guide.html">
            
                
                    <a href="../proto3/style_guide.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.3.</b>
                        
                         风格指南(翻译)
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.4" data-path="proto3/encoding.html">
            
                
                    <a href="../proto3/encoding.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.4.</b>
                        
                         编码(翻译)
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.1.5" data-path="proto3/techniques.html">
            
                
                    <a href="../proto3/techniques.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.5.</b>
                        
                         技巧(翻译)
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> gPRC文档</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" >
            
            <span><b>3.1.</b> 官网开发指南</span>
            
            
            <ul class="articles">
                
    
        
        <li class="chapter active" data-level="3.1.1" data-path="grpc/overview.html">
            
                
                    <a href="../grpc/overview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                         概述(笔记)
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.1.2" data-path="grpc/grpc_concepts.html">
            
                
                    <a href="../grpc/grpc_concepts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                         gRPC概念(笔记)
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Leaning Grpc</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_3">
                    
                        <h1 id="grpc">gRPC概述</h1>
<p>注: 官网文档<a href="http://www.grpc.io/docs/" target="_blank">Guide Overview</a>的读书笔记, 这个文档水比较多, 不直接逐段翻译, 只摘录部分内容作为读书笔记.</p>
<p>一开始就如下介绍gRPC:</p>
<blockquote>
<p>a language-neutral, platform-neutral, open source, remote procedure call (RPC) system initially developed at Google.</p>
<p>一个语言无关, 平台无关, 开源的RPC系统, 最初由google开发</p>
</blockquote>
<p>注: 和protocol buffer的介绍一样, 非常强调&quot;语言无关, 平台无关&quot;.</p>
<h1 id="grpc">什么是gRPC?</h1>
<p>在gRPC中, 客户端应用可以直接调用在另外一个机器上运行的服务器应用, 就好像调用本地对象一样, 使得创建分布式应用和服务变得简单. 和很多RPC系统一样, gRPC是基于这样的思路: 定义服务, 指定可以被远程调用的方法, 带有参数和返回类型. 在服务器端, 服务器实现接口并运行一个gRPC服务器来处理客户端调用. 在客户端这边, 客户端有一个桩(stub)来提供和服务器端完全一样的方法.</p>
<p><img src="http://www.grpc.io/img/grpc_concept_diagram_00.png" alt=""></p>
<h1 id="working-with-protocol-buffers">Working with protocol buffers</h1>
<p>gRPC默认使用Protocol buffer, 版本为proto3. 但是据说gRPC也可以使用其他的序列化方案, 比如json. 注: 然后并没有看到到底如何用和哪个项目在用.</p>
<h1 id="hello-grpc">Hello gRPC!</h1>
<p>用一个最简单的例子来示范如何使用gRPC, 需要三个步骤.</p>
<ul>
<li>Create a protocol buffers schema that defines a simple RPC service with a single Hello World method.</li>
<li>Create a server that implements this interface in your favourite language (where available).</li>
<li>Create a client in your favourite language (or any other one you like!) that accesses your server.</li>
</ul>
<h2 id="install-grpc">Install gRPC</h2>
<p>好消息是, 对于java,不需要安装什么, 有jdk和grpc的依赖包就好了.</p>
<h2 id="">定义服务</h2>
<p>在helloworld.proto文件中定义服务:</p>
<pre><code class="lang-java">syntax = <span class="hljs-string">"proto3"</span>;

option java_package = <span class="hljs-string">"io.grpc.examples"</span>;

<span class="hljs-keyword">package</span> helloworld;

<span class="hljs-comment">// The greeter service definition.</span>
service Greeter {
  <span class="hljs-comment">// Sends a greeting</span>
  <span class="hljs-function">rpc <span class="hljs-title">SayHello</span> <span class="hljs-params">(HelloRequest)</span> <span class="hljs-title">returns</span> <span class="hljs-params">(HelloReply)</span> </span>{}
}

<span class="hljs-comment">// The request message containing the user's name.</span>
message HelloRequest {
  string name = <span class="hljs-number">1</span>;
}

<span class="hljs-comment">// The response message containing the greetings</span>
message HelloReply {
  string message = <span class="hljs-number">1</span>;
}
</code></pre>
<h2 id="grpc">生成gRPC代码</h2>
<p>具体如何生成代码后面再看, 先看生成的结果里面都有什么.</p>
<p>在这个example中生成的代码在src/generated/main中, 有两个目录:</p>
<ol>
<li>grpc: 里面只有一个io/grpc/examples/helloworld/GreeterGrpc.java文件, 包含和rpc调用相关的代码, 比如service定义, 客户端stub的实现等.</li>
<li>java: 在目录io/grpc/examples/helloworld里面有多个java文件, HelloRequest.java和HelloResponse.java是从.proto文件中的message定义生成的message类. HelloRequestOrBuilder和HelloResponseOrBuilder是对应HelloRequest和java和HelloResponse的builder类. 然后还有一个HelloWorldProto.java, 里面保存了一些和.proto相关的信息.</li>
</ol>
<h2 id="grpc">生成的grpc代码</h2>
<p>在GreeterGrpc.java的文件中, 在这个java文件中package定义为</p>
<pre><code>package io.grpc.examples.helloworld;
</code></pre><p>对应上面的.proto文件中的java_package和package两个设置, 似乎最终得到的java package为java_package + package?</p>
<pre><code>option java_package = &quot;io.grpc.examples&quot;;
package helloworld;
</code></pre><p>在GreeterGrpc.java中内嵌有多个java类.</p>
<h3 id="greeter">Greeter接口定义</h3>
<ul>
<li><p>interface Greeter</p>
<p>  对应.proto文件中的service定义, 特别留意这里的sayHello()方法的定义,HelloResponse并不是简单的函数返回的方式.</p>
<pre><code class="lang-java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Greeter</span> </span>{
      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">(HelloRequest request, StreamObserver&lt;HelloResponse&gt; responseObserver)</span></span>;
  }
</code></pre>
</li>
<li><p>GreeterBlockingClient和GreeterFutureClient</p>
<p>  提供和Greeter接口功能相同但是调用方式不一样的两种客户端调用接口.</p>
<pre><code class="lang-java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GreeterBlockingClient</span> </span>{
      <span class="hljs-comment">// 这个是阻塞模式, 因此sayHello方法是用方法return的方式返回HelloResponse</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> HelloResponse <span class="hljs-title">sayHello</span><span class="hljs-params">(HelloRequest request)</span></span>;
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">GreeterFutureClient</span> </span>{
      <span class="hljs-comment">// future方式, 返回一个ListenableFuture</span>
      <span class="hljs-function"><span class="hljs-keyword">public</span> ListenableFuture&lt;HelloResponse&gt; <span class="hljs-title">sayHello</span><span class="hljs-params">(HelloRequest request)</span></span>;
  }
</code></pre>
</li>
</ul>
<h3 id="greeter">Greeter的客户端桩实现</h3>
<ul>
<li><p>GreeterStub</p>
<p>  client端的stub实现类, 实现Greeter接口.</p>
<pre><code class="lang-java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreeterStub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">io</span>.<span class="hljs-title">grpc</span>.<span class="hljs-title">stub</span>.<span class="hljs-title">AbstractStub</span>&lt;<span class="hljs-title">GreeterStub</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">Greeter</span> </span>{ }
</code></pre>
</li>
<li><p>GreeterBlockingStub 和 GreeterFutureStub</p>
<p>  client端的blocking stub实现类, 实现GreeterBlockingClient接口.</p>
<pre><code class="lang-java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreeterBlockingStub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractStub</span>&lt;<span class="hljs-title">GreeterBlockingStub</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">GreeterBlockingClient</span> </span>{}
</code></pre>
<p>  client端的future stub实现类, 实现GreeterFutureClient接口.</p>
<pre><code class="lang-java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreeterFutureStub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractStub</span>&lt;<span class="hljs-title">GreeterFutureStub</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">GreeterFutureClient</span> </span>{}
</code></pre>
</li>
</ul>
<h3 id="stub">创建stub的方法</h3>
<p>提供三个方法用来创建三种调用方法所需要的client stub.</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> GreeterStub <span class="hljs-title">newStub</span><span class="hljs-params">(Channel channel)</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">GreeterStub</span><span class="hljs-params">(channel)</span></span>;
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> GreeterBlockingStub <span class="hljs-title">newBlockingStub</span><span class="hljs-params">(Channel channel)</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">GreeterBlockingStub</span><span class="hljs-params">(channel)</span></span>;
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> GreeterFutureStub <span class="hljs-title">newFutureStub</span><span class="hljs-params">(Channel channel)</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">GreeterFutureStub</span><span class="hljs-params">(channel)</span></span>;
}
</code></pre>
<h3 id="">其他代码内容</h3>
<h4 id="service_name">SERVICE_NAME常量定义</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GreeterGrpc</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SERVICE_NAME = <span class="hljs-string">"helloworld.Greeter"</span>;
}
</code></pre>
<p>注意这个常量定义是public, 需要用到的时候应该可以直接调用或者反射调用来获取当前服务名.</p>
<h4 id="">静态方法定义</h4>
<p>从注释上看, &quot;Static method descriptors that strictly reflect the proto&quot;, 这里是生成了静态方法描述以便以后做反射的时候使用.</p>
<pre><code class="lang-java">  <span class="hljs-comment">// Static method descriptors that strictly reflect the proto.</span>
  <span class="hljs-annotation">@io</span>.grpc.ExperimentalApi
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> io.grpc.MethodDescriptor&lt;io.grpc.examples.helloworld.HelloRequest,
      io.grpc.examples.helloworld.HelloResponse&gt; METHOD_SAY_HELLO =
      io.grpc.MethodDescriptor.create(
          io.grpc.MethodDescriptor.MethodType.UNARY,
          generateFullMethodName(
              <span class="hljs-string">"helloworld.Greeter"</span>, <span class="hljs-string">"SayHello"</span>),
          io.grpc.protobuf.ProtoUtils.marshaller(io.grpc.examples.helloworld.HelloRequest.getDefaultInstance()),
          io.grpc.protobuf.ProtoUtils.marshaller(io.grpc.examples.helloworld.HelloResponse.getDefaultInstance()));
</code></pre>
<h4 id="bindservice">bindService()方法</h4>
<p>TBD: 还没有看懂这个方法的用途, 和在哪里调用, 后续看懂了再更新.</p>
<h2 id="java">生成的java代码</h2>
<p>在目录io/grpc/examples/helloworld里面的这些java代码:</p>
<ul>
<li>HelloRequest.java和HelloResponse.java是从.proto文件中的message定义生成的message类.</li>
<li>HelloRequestOrBuilder和HelloResponseOrBuilder是对应HelloRequest和java和HelloResponse的builder类.</li>
<li>HelloWorldProto.java, 里面保存了一些和.proto相关的信息.</li>
</ul>
<p>message类和对应的Builder类的关系后面再具体看.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        
        <a href="../grpc/grpc_concepts.html" class="navigation navigation-next navigation-unique" aria-label="Next page: gRPC概念(笔记)"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
